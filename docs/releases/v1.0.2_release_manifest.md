# Ulysses CRM — v1.0.2 Release Manifest & Transition

**Release:** v1.0.2
**Date:** 2026‑01‑30
**Status:** Released to production (Render)

---

## What shipped in v1.0.2

### Phase 7B — User Onboarding & Tenant Isolation (Closed)

This release finalizes Phase 7B and hardens multi‑user support without introducing email delivery or teams.

**Core outcomes:**

* Invite‑only onboarding (admin‑generated links)
* Password reset via admin‑generated links
* Strict tenant isolation across all user‑owned data
* Canon‑compliant ownership enforcement

---

## Key Changes

### 1. Invite & Reset Links (Production‑Safe)

* Introduced `PUBLIC_BASE_URL` as the sole authority for generating invite and reset links
* Removed all fallbacks to `request.host`, `url_for(_external=True)`, or localhost defaults
* Application **fails loudly** if `PUBLIC_BASE_URL` is missing in production

**Result:**

* Invite and reset links always point to the correct HTTPS production domain
* No accidental leakage of `127.0.0.1` or non‑secure URLs

---

### 2. Token Security

* All invite and reset tokens:

  * Cryptographically secure
  * Stored hashed only
  * Single‑use
  * Time‑limited
* Enforced `TOKEN_PEPPER` requirement in production

---

### 3. Tenant Isolation (Audit‑Verified)

**Confirmed tenant keys:**

* `user_id`
* `created_by_user_id` (Open Houses)

**Fixed / enforced:**

* Professionals fully scoped by `user_id`
* Open Houses and sign‑ins protected against ID guessing
* Public open‑house sign‑ins write with owner user_id (defense in depth)
* Templates table migrated to tenant ownership

All list, detail, update, delete, export, and public routes verified.

---

### 4. User Profile & Brokerage

* Unified user profile and brokerage data model
* Added support for agent branding fields
* Brokerages keyed strictly by `user_id`

---

### 5. Input UX Consistency (Restored)

**Phone fields:**

* Opt‑in formatting via `.phone-input`
* Auto‑formats `(555) 555‑5555` on blur
* Stored value remains raw text

**Website fields:**

* Accept `example.com`, `www.example.com`, or full URLs
* No forced `http://` or `https://`
* Stored exactly as entered

**Canonical rule:**

* Formatting is UI‑only and opt‑in
* No server‑side mutation of phone or URL values

---

## Database Migrations Applied

All migrations below were applied safely to production:

* `2026_01_23_user_invites_password_resets.sql`
* `2026_01_25_local_professionals_add_user_id.sql`
* `2026_01_25_open_house_signins_add_user_id.sql`
* `2026_01_26_templates_add_user_id_tenant_isolation.sql`
* `2026_01_28_prod_fix_templates_fk.sql`
* `2026_01_26_user_profile_and_brokerage_fields.sql`

Idempotency verified where applicable.

---

## Canon Updates

Phase 7B is now **closed** in Canon:

* Invite‑only onboarding complete
* Admin recovery paths defined
* Tenant isolation enforced as a non‑negotiable rule

Future enhancements explicitly deferred:

* SMTP delivery
* Teams
* 2FA

---

## Versioning

* Tagged release: **v1.0.2**
* `version.py` updated and committed
* `main` branch clean and pushed

Next release will be **v1.0.3+**, depending on scope.

---

## Transition to Next Chat

**System state:**

* Production is stable
* Phase 7B complete
* Canon up to date

**Safe starting points for next work:**

* Phase 8 feature planning
* UX refinements (non‑breaking)
* Performance or observability improvements
* Deferred cleanups (phone/url opt‑in expansion)

No known blockers or partial migrations remain.

---

**End of v1.0.2**
