<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>{% block title %}Ulysses CRM{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >


    <style>
      body {
        background: url("/static/backgrounds/house-bg.jpg");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
      }
        body.openhouse-public {
         background: #ffffff !important;
      }
    
      .content-panel {
        background-color: rgba(245, 246, 248, 0.96);
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      }
    
      .contacts-table,
      .contacts-table thead th,
      .contacts-table tbody tr td {
        background-color: #ffffff !important;
      }
    
      .contacts-table tbody tr:hover td {
        background-color: #f7f7f7 !important;
      }
    
      .card-header {
        font-size: 0.95rem;
        font-weight: 600;
      }
    
      /* ...rest of your existing styles... */
    </style>

    {% block extra_head %}{% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">

{% set hide_nav = hide_nav|default(false) %}

{% if not hide_nav %}

<nav class="navbar navbar-expand-md navbar-light bg-white shadow-sm border-bottom sticky-top">
  <div class="container-fluid py-2" style="font-size: 0.9rem;">

    <!-- Logo -->
    <a href="{{ url_for('dashboard') }}" class="navbar-brand d-flex align-items-center text-dark">
      <img
        src="{{ url_for('static', filename='ulysses-logo.svg') }}"
        alt="Ulysses CRM"
        style="height: 50px;"
        class="me-2"
      >
    </a>

    <!-- Hamburger button -->
    <button class="navbar-toggler" type="button"
            data-bs-toggle="collapse"
            data-bs-target="#mainNav"
            aria-controls="mainNav"
            aria-expanded="false"
            aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collapsible nav links -->
    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav ms-0 ms-md-2">

        <li class="nav-item">
          <a href="{{ url_for('dashboard') }}"
             class="nav-link {% if active_page == 'dashboard' %}fw-semibold{% endif %}">
            Dashboard
          </a>
        </li>

        <li class="nav-item">
          <a href="{{ url_for('contacts') }}"
             class="nav-link {% if active_page == 'contacts' %}fw-semibold{% endif %}">
            Contacts
          </a>
        </li>
 
        <li class="nav-item">
          <a href="{{ url_for('professionals') }}"
             class="nav-link {% if active_page == 'professionals' %}fw-semibold{% endif %}">
            Professionals
          </a>
        </li>

        <li class="nav-item">
          <a href="{{ url_for('followups') }}"
             class="nav-link {% if active_page == 'followups' %}fw-semibold{% endif %}">
            Follow Up Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('openhouse_list') }}">Open Houses</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="{{ calendar_feed_url }}" target="_blank">Calendar Feed</a>

        </li>

      </ul>
    </div>
  </div>
</nav>
{% endif %}

<div class="container py-4">
    {% block content %}{% endblock %}
</div>

<footer class="text-center text-muted py-3 small bg-white border-top">
    Â© {{ current_year }} Ithaca Enterprises. All rights reserved.
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% block extra_scripts %}{% endblock %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Do nothing if the browser doesn't support notifications
    if (!("Notification" in window)) {
      console.log("Browser does not support notifications.");
      return;
    }

    // Ask permission on first visit
    if (Notification.permission === "default") {
      Notification.requestPermission().then(function (permission) {
        if (permission !== "granted") {
          console.log("Notifications not granted.");
        }
      });
    }

    function checkDueReminders() {
      if (Notification.permission !== "granted") {
        return;
      }

      fetch("{{ url_for('api_reminders_due') }}", {
        credentials: "include"
      })
        .then((response) => response.json())
        .then((data) => {
          if (!Array.isArray(data)) return;

          data.forEach((reminder) => {
            let title = "Ulysses CRM Reminder";

            let body = "";
            if (reminder.contact_name) {
              body += reminder.contact_name + ": ";
            }
            body += reminder.title || "Reminder due.";

            // Show the system notification
            let notification = new Notification(title, {
              body: body,
              icon: "{{ url_for('static', filename='ulysses-logo.svg') }}"
            });

            // Clicking the notification should focus the CRM tab
            notification.onclick = function () {
              window.focus();
            };
          });
        })
        .catch((err) => {
          console.error("Error checking reminders:", err);
        });
    }

    // Check immediately on page load
    checkDueReminders();

    // Then check every 60 seconds
    setInterval(checkDueReminders, 60000);
  });
</script>

</body>
</html>
